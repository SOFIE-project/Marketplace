Offer Marketplace
=================

This repository contains a **template** that implements the *Offer
Marketplace* business platform as described as part of the SOFIE
project's [Business Platforms
document](https://media.voog.com/0000/0042/0957/files/SOFIE_D3.2-Business_Platform_Lab_Prototype_Release.pdf).

# How to use this template?

## Testing out the sample marketplace

TBD --- have instructions here on how to use the sample code and
deployment scripts to deploy the sample marketplace

## Re-using the template

This project can be extended in multiple ways. The recommended way is
to use this project as a *dependency* in your own project, and re-use
these components via imports or other references (depending on whether
you are working on Python or Solidity parts of the code).

* Most of the primary code is designed to be loosely coupled and
  re-usable. Thus while the examples use Flask for building web
  services, the core itself is modularized as library a Python library
  and should be re-usable in other environments.

# Documentation

TBD --- API documentation somewhere (readthedocs or similar?)

The project's technical design and architecture documentation (as well
as other stuff) can be found in the [doc](/doc/README.md) directory.

## Generating documentation for Python code

We use a mix of markdown and reStructuredText format for documenting
the project. Python code documentation is autogenerated by using
Sphinx. You can see the `md` and `rst` files in the `doc`
directory. To generate the documentation you should install `sphinx`
and the various sphinx extensions that are used::

    $ pip install sphinx m2r sphinxcontrib-httpdomain sphinxcontrib-soliditydomain sphinxcontrib-seqdiag

Now you can run

    $ make html

to generate documentation. Generated documentation is saved in
`doc/html`. `index.html` is the main page and you can find all
documentations by its links.

# Building and running local tests

You probably should use `pyenv`, but the setup.py should work
regardless normally. For testing, just run:

	$ python setup.py test

Although since this tree uses py.test and tox, running any of the
following should *approximately* run the same test suite (apart from
environment and python version differences):

	$ py.test
	$ tox

For testing out the marketplace tool `offer-marketplace-cli`, you need
first to set up the environment. First, set up truffle and a local
ethereum node (Ganache, for example), then:

	$ (cd solidity && truffle migrate)
	$ export WEB3_PROVIDER_URI=http://localhost:7545
	$ export MARKETPLACE_ACCOUNT=account-id-from-ganache-console
	$ export MARKETPLACE_CONTRACT=contract-from-truffle-migrate
	$ export REGISTERED_ACCOUNT=sofie_offer_marketplace_cli
	$ offer-marketplace-cli --manager add-request "in 5 minutes" 1000 0
	$ offer-marketplace-cli list

Keep in mind that you should use `SET` instead of `export` in Windows.

# Running backend

The provided backend is implemented by using `FlaskRESTful`. For running 
the backend, first you should set its environment variable to located package:
    
    $ export FLASK_APP=sofie_offer_marketplace.backend
    
After this step, you can use the command below to run it:

    $ flask run

# Testing

The provided makefile has simple targets to test all of the
parts.

	$ make all
	$ make test

# License

This project is under the Apache License 2.0.
