Offer Marketplace
=================

# Description

This component provides a generic model of request-offer (or
proposal-bid) batch transaction model.

# Architecture Overview

The goal of the SOFIE marketplace component is to enable the trade of
different types of assets in an automated, decentralised, and flexible
way. The actors (buyers and sellers) are able to carry out trades by
placing bids and offers using the marketplace component, which
utilises *Ethereum smart contracts*.

Figure below shows an overview of the marketplace component and its interfaces.

![MarketplaceInterfaces](/doc/images/MarketplaceInterfaces.png)

The marketplace component offers two interfaces: Request Maker for
sellers to create, manage and conclude auctions, and Offer Maker for
buyers to participate and bid in auctions.

Figure below shows an internal structure of the marketplace component.

![MarketplaceClasses](/doc/images/MarketplaceClasses.png)

MarketplaceModule includes functionality to communicate with
marketplace smart contracts (which are shown in dotted
line). MarketplaceInterface smart contract includes offer maker and
request maker interfaces. MarketplaceBase includes all of base
functionalities for the marketplace component, while EthereumStandards
includes the standard Ethereum tokens like
[ERC20](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md).

The component's technical design and architecture documentation can be
found in the [doc](/doc/) directory.

# Relation with SOFIE

This repository contains a **template** that implements the *Offer
Marketplace* business platform as described as part of the SOFIE
project's [Business Platforms
document](https://media.voog.com/0000/0042/0957/files/SOFIE_D3.2-Business_Platform_Lab_Prototype_Release.pdf).

# Key Technologies

This component uses *Flask* for back-end web services and *Ethereum
Smart Contract* written in *Solidity* for interacting with *Ethereum
Blockchain*. Also, *offer-marketpalce-cli* uses *web3* in order to
interact with the smart contracts.

# Usage

# Installation

## Prerequisites

You can install dependencies with running following commands:

	$ python setup.py build
	$ python setup.py install

## Execution

The provided backend is implemented by using `FlaskRESTful`. For running
the backend, first you should set its environment variable to located package:

    $ export FLASK_APP=sofie_offer_marketplace.backend

After this step, you can use the command below to run it:

    $ flask run

## Re-using the template

This project can be extended in multiple ways. The recommended way is
to use this project as a *dependency* in your own project, and re-use
these components via imports or other references (depending on whether
you are working on Python or Solidity parts of the code).

* Most of the primary code is designed to be loosely coupled and
  re-usable. Thus while the examples use Flask for building web
  services, the core itself is modularized as library a Python library
  and should be re-usable in other environments.

# Testing

## Prerequisites

The list of dependencies for running tests can be found in `tox.ini` file.

## Running the tests

You probably should use `pyenv`, but the setup.py should work
regardless normally. For testing, just run:

	$ python setup.py test

Although since this tree uses py.test and tox, running any of the
following should *approximately* run the same test suite (apart from
environment and python version differences):

	$ py.test
	$ tox

For testing out the marketplace tool `offer-marketplace-cli`, you need
first to set up the environment. First, set up truffle and a local
ethereum node (Ganache, for example), then:

	$ (cd solidity && truffle migrate)
	$ export WEB3_PROVIDER_URI=http://localhost:7545
	$ export MARKETPLACE_ACCOUNT=account-id-from-ganache-console
	$ export MARKETPLACE_CONTRACT=contract-from-truffle-migrate
	$ export REGISTERED_ACCOUNT=sofie_offer_marketplace_cli
	$ offer-marketplace-cli --manager add-request "in 5 minutes" 1000 0
	$ offer-marketplace-cli list

Keep in mind that you should use `SET` instead of `export` in Windows.

The provided makefile has simple targets to test all of the
parts.

	$ make all
	$ make test


## Evaluating the results

The tests results will be shown in the terminal. If the test fails, a
corresponding message will be shown.

# Integration

Thers is no continuous integration support in this release.

# Deployment

The demo back-end describes an example how to deploy the
component. You can find more information about deployment in the
`demo/README.md` file.

# Known and Open issues

TDB.

# Generating documentation for Python code

We use a mix of markdown and reStructuredText format for documenting
the project. Python code documentation is autogenerated by using
Sphinx. You can see the `md` and `rst` files in the `doc`
directory. To generate the documentation you should install `sphinx`
and the various sphinx extensions that are used:

    $ pip install sphinx m2r sphinxcontrib-httpdomain sphinxcontrib-soliditydomain sphinxcontrib-seqdiag

Now you can run

    $ make html

to generate documentation. Generated documentation is saved in
`doc/html`. `index.html` is the main page and you can find all
documentations by its links.

# Contact info

Please contact Santeri Paavolainen (Aalto University) in case of any questions.

# License

This component is licensed under the Apache License 2.0.
